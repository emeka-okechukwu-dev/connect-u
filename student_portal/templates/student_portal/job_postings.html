{% extends "student_portal/base.html" %}
{% block title %} Job Postings | Connect-U Students {% endblock title %}
{% block content %}
    <div class="container-fluid">
        <h2 class="text-left mb-5" style="color: #912338;"><span class="fa fa-search"></span> Current Listings</h2>
        <div class="row">
           <form class="form-inline my-2 my-lg-0" method="GET">
              <div class="input-group">
                 <input class="form-control" type="search" placeholder="Search Job Title" aria-label="Search" name="search">
                 <div class="input-group-append">
                    <button class="btn btn-outline-info" type="submit">Search</button>
                    {% if request.GET.search %}
                    <a href="{% url 'student_portal-job_postings' %}" class="btn btn-secondary ml-2">Show All</a>
                    {% endif %}
                 </div>
              </div>
              <div class="input-group ml-3">
                 <div class="input-group-prepend">
                    <label class="input-group-text" for="jobType">Job Type</label>
                 </div>
                 <select class="custom-select" id="jobType" name="job_type">
                 <option value="" {% if not request.GET.job_type %}selected{% endif %}>All</option>
                 <option value="Full-time" {% if request.GET.job_type == "Full-time" %}selected{% endif %}>Full-time</option>
                 <option value="Part-time" {% if request.GET.job_type == "Part-time" %}selected{% endif %}>Part-time</option>
                 <option value="Contract" {% if request.GET.job_type == "Contract" %}selected{% endif %}>Contract</option>
                 <option value="Temporary" {% if request.GET.job_type == "Temporary" %}selected{% endif %}>Temporary</option>
                 <option value="Volunteer" {% if request.GET.job_type == "Volunteer" %}selected{% endif %}>Volunteer</option>
                 <option value="Internship" {% if request.GET.job_type == "Internship" %}selected{% endif %}>Internship</option>
                 <option value="Other" {% if request.GET.job_type == "Other" %}selected{% endif %}>Other</option>
                 </select>
                 <div class="input-group-append">
                    <button class="btn btn-outline-info" type="submit">Filter</button>
                    {% if request.GET.job_type %}
                    <a href="{% url 'student_portal-job_postings' %}" class="btn btn-secondary ml-2">Clear Filter</a>
                    {% endif %}
                 </div>
              </div>
           </form>
        </div>
        <div style="margin-bottom: 20px;"></div>
        <table class="table">
            <caption>Job Postings Table</caption>
            <thead style="background-color: #912338; color: white;">
                <tr>
                    <th class="eye-column" style="width: 1%;"></th>
                    <th>Job Title</th>
                    <th>Location</th>
                    <th>Application Deadline</th>  <!-- New column -->
                </tr>
            </thead>
            <tbody>
                {% for job in job_postings %}
                    <tr>
                        <td class="eye-column"><a href="#" data-toggle="modal" data-target="#jobModal-{{ job.job_id }}"><i class="fa fa-eye" style="color: #912338;"></i></a></td>
                        <td>{{ job.title }}</td>
                        <td>{{ job.location }}</td>
                        <td>{{ job.application_deadline }}</td>  <!-- New column -->
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">No job postings found.</td>  <!-- Update colspan -->
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% for job in job_postings %}
            <div class="modal fade" id="jobModal-{{ job.job_id }}" tabindex="-1" role="dialog" aria-labelledby="jobModalLabel-{{ job.job_id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="jobModalLabel-{{ job.job_id }}">{{ job.title }}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>{{ job.description }}</p>
                            <p><strong>Location:</strong> {{ job.location }}</p>
                            <p><strong>Company Name:</strong> {{ job.company_name }}</p>
                            <p><strong>Website:</strong> <a href="{{ job.website }}" target="_blank" style="color: #912338;">{{ job.website }}</a></p>
                            <p><strong>Type:</strong> {{ job.job_type }}</p>
                            <p><strong>Category:</strong> {{ job.job_category }}</p>
                            <p><strong>Requirements:</strong> {{ job.requirements }}</p>
                            <p><strong>Salary:</strong> {{ job.salary }}</p>
                            <p><strong>Application Deadline:</strong> {{ job.application_deadline }}</p>
                            <p><strong>Contact Info:</strong> {{ job.contact_info }}</p>
                            {% if job.job_id in applied_job_ids %}
                                <p>You have already applied to this job.</p>
                            {% else %}
                                <form method="POST" action="{% url 'apply_for_job' job.job_id %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="student_username" value="{{ request.user.profile }}">
                                    <input type="hidden" name="job_id" value="{{ job.job_id }}">
                                    <button type="submit" class="btn btn-primary">Apply</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}